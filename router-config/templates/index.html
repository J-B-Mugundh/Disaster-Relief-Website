<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NGN Lab Disaster Relief Website</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        font-family: "Roboto", sans-serif;
        background: linear-gradient(to right, #6a11cb, rgb(226, 205, 249));
        color: white;
        text-align: center;
        margin: 0;
        padding: 0;
      }
      .container {
        width: 100%;
        max-width: 500px;
        margin: 50px auto;
        background: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
      }
      h1 {
        font-size: 26px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      h1 i {
        margin-right: 10px;
      }
      textarea,
      input {
        width: 80%;
        margin-bottom: 15px;
        padding: 10px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
      }
      textarea {
        height: 100px;
        resize: none;
      }
      input[type="file"] {
        background: #fff;
        padding: 5px;
        color: #333;
      }
      button {
        width: 80%;
        background: #f9d423;
        color: black;
        font-size: 18px;
        padding: 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: 0.3s;
      }
      button:hover {
        background: #ff4e50;
        color: white;
      }
      #result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
        background: rgba(255, 255, 255, 0.2);
      }
      #result h3 {
        margin-bottom: 10px;
      }
      .severity {
        font-size: 18px;
        font-weight: bold;
        padding: 10px;
        border-radius: 5px;
      }
      .low {
        background: #4caf50;
      }
      .moderate {
        background: #ff9800;
      }
      .high {
        background: #e53935;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        <i class="fas fa-exclamation-triangle"></i> NGN Lab Disaster Relief Website
      </h1>

      <img src="{{ url_for('static', filename='images/ngnlab.jpg') }}" alt="NGN Lab Logo" style="max-width: 200px; margin-bottom: 20px;" />

      <p>We're here to save you!!!</p>

      <form id="disaster-form" enctype="multipart/form-data">
        <textarea
          name="text_message"
          placeholder="Describe the situation..."
          rows="4"
        ></textarea>
        <input type="file" name="image_message" accept="image/*" />
        <button type="submit">
          <i class="fas fa-search"></i> Analyze
        </button>
      </form>

      <div id="result"></div>
    </div>

    <script>
      document.getElementById("disaster-form").onsubmit = async function (
        event
      ) {
        event.preventDefault();
        const formData = new FormData(this);

        try {
          const response = await fetch("/submit", {
            method: "POST",
            body: formData,
          });

          if (!response.ok)
            throw new Error(`HTTP error! Status: ${response.status}`);

          const data = await response.json();

          // Extract values
          const text_classification = data.text_classification || "Not Disaster Related";
          const image_severity = data.image_severity || "level1";

          // Mapping MobileBERT score
          const mobilebert_score = text_classification === "Disaster-related" ? 1.0 : 0.0;
          console.log(mobilebert_score)

          // Mapping YOLOv8 confidence
          let yolo_conf = 0;
          if (image_severity == "level1") yolo_conf = 0.3;
          else if (image_severity == "level2") yolo_conf = 0.6;
          else if (image_severity == "level3") yolo_conf = 1.0;

          console.log(image_severity, yolo_conf)

          // Calculate Disaster Severity Score
          const severity_score = (0.75 * yolo_conf + 0.25 * mobilebert_score).toFixed(2);

          // Determine severity level
          let severity_level = "Unknown";
          let severity_class = "";
          if (severity_score >= 0 && severity_score <= 0.4) {
            severity_level = "Low Severity";
            severity_class = "low";
          } else if (severity_score > 0.4 && severity_score <= 0.75) {
            severity_level = "Moderate Severity";
            severity_class = "moderate";
          } else if (severity_score > 0.75) {
            severity_level = "High Severity";
            severity_class = "high";
          }

          // Update result section
          document.getElementById("result").innerHTML = `
            <h3><i class="fas fa-chart-line"></i> Results:</h3>
            <p><strong>Text Classification:</strong> ${text_classification}</p>
            <p><strong>Image Severity:</strong> ${image_severity}</p>
            <p><strong>Disaster Severity Score:</strong> ${severity_score}</p>
            <p class="severity ${severity_class}">${severity_level}</p>
            <p><i class="fas fa-hands-helping"></i> Need Assistance? Contact Local Authorities!</p>
          `;
        } catch (error) {
          console.error("Fetch error:", error);
          document.getElementById(
            "result"
          ).innerHTML = `<p style="color: red;"><i class="fas fa-times-circle"></i> Error submitting request. Check console.</p>`;
        }
      };
    </script>
  </body>
</html>
